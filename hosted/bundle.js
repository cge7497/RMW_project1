(()=>{"use strict";const e=(e,t,o,n,a,l)=>{n&&(a*=-1),o.clearRect(0,0,640,480),o.save(),o.beginPath(),o.arc(e,t-3*a,3,0,2*Math.PI),o.moveTo(e,t),o.lineTo(e,t+5*a),o.lineTo(e-2*a,t+8*a),o.moveTo(e,t+5*a),o.lineTo(e+2*a,t+8*a),o.moveTo(e-3*a,t+3*a),o.lineTo(e+3*a,t+3*a),l&&(o.strokeStyle=l),o.stroke(),o.closePath(),o.restore()},t=(e,t,o,n,a,l,i)=>{a.save(),a.beginPath(),a.moveTo(e,t),a.lineTo(e+o,t),a.lineTo(e+o,t+n),a.lineTo(e,t+n),a.closePath(),i?(a.fillStyle=l,a.fill()):(a.strokeStyle=l,a.lineWidth=3,a.stroke()),a.restore()},o=async e=>{switch(e.status){case 200:case 204:break;default:let t=await e.json();console.error(t)}},n=async(e,t)=>{const n=`name=${e}&item=${t}`;let a=await fetch("/updateItems",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:n});o(a)};class a{constructor(e,t,o,n,a){this.x=e,this.y=t,this.width=o,this.height=n,this.color=a,this.hSpeed=n*o/15,this.vSpeed=0}}const l=[{x:280,y:315,width:31,height:30,color:"red"},{x:0,y:0,width:30,height:800,color:"blue"},{x:0,y:950,width:30,height:502,color:"blue"},{x:-200,y:801,width:30,height:30,color:"red"},{x:-200,y:700,width:200,height:50,color:"blue"},{x:-200,y:998,width:200,height:50,color:"blue"},{x:-650,y:700,width:200,height:50,color:"blue"},{x:-650,y:998,width:200,height:50,color:"blue"},{x:-650,y:750,width:50,height:250,color:"blue"},{x:1e3,y:36,width:30,height:1494,color:"green"},{x:0,y:1500,width:1030,height:30,color:"black"},{x:-700,y:1500,width:700,height:30,color:"yellow"},{x:0,y:0,width:1030,height:30,color:"orange"}],i=[{x:-540,y:982,width:16,height:16,id:"screwattack"},{x:300,y:982,width:16,height:16,id:"morphball"},{x:296,y:-16,width:16,height:16,id:"yellowswitch"}];let h,c,r;const d=[],s={};let y=[],w=0,m=0;const g={screwattack:document.getElementById("screwattack"),morphball:document.getElementById("morphball"),yellowswitch:document.getElementById("yellowswitch")},u={screwattack:{obtained:!1,collected:N},morphball:{obtained:!1,collected:_},yellowswitch:{collected:G}},f={x:300,y:300,halfWidth:4,halfHeight:7,newX:300,newY:300,scale:1,name:""};let x,b,v,k,T=0,S=0,E=!1,M=!0,H=!1,I=!1,$=!1,C=!1,L=0,W=[],X=0,Y=0,B=0;const P=()=>{I?G():(q(),e(f.x+Y,f.y+B,c,E,f.scale),((e,t,o,n)=>{t.fillRect(e.x+o-e.width/2,e.y+n-e.height/2,e.width,e.height,"blue")})(f,c,Y,B)),A()},q=()=>{let e=0,t=0;W[65]&&(e=-2),W[68]&&(e=2),t=E?-3:3,$?W[87]&&(B-=((e,t)=>{let o=4,n=0;return t&&(o=-4),1===e.scale?(e.scale=.1,e.halfWidth=1,e.halfHeight=1,n=-o):(e.scale=1,e.halfWidth=4,e.halfHeight=7,n=-3*o),e.y+=n,n})(f,E),$=!1,L=30,e=0,t=0):C&&(L-=1,L<=0&&($=!0)),f.newX=f.x+e,f.newY=f.y+t,D(f,e,t)?(Y+=f.x-f.newX,B+=f.y-f.newY,f.x=f.newX,f.y=f.newY):(f.x+=e,f.y+=t,Y-=e,B-=t),F(f)},A=()=>{l.forEach((e=>{t(e.x+Y,e.y+B,e.width,e.height,c,e.color,!0)})),i.forEach((e=>{c.drawImage(g[e.id],e.x+Y,e.y+B)}))},O=()=>{r.clearRect(0,0,640,480),t(0,0,x,b,r,"white",!0),X+=0,d.forEach((function(e){e.hSpeed=1*Math.cos(X),e.vSpeed=1*Math.sin(X),e.x+=e.hSpeed,e.y+=e.vSpeed,e.x>x+20?e.x=-20:e.x<-20&&(e.x=x+20),e.y>b+20?e.y=-20:e.y<-20&&(e.y=b+20),t(e.x,e.y,e.width,e.height,r,e.color,!0)}))},j=()=>{s&&((async(e,t)=>{const n=`movement=${JSON.stringify(t)}`;let a=await fetch("/addMovement",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:n});o(a)})(f.name,s),console.log(s),w=0,m=0)},R=()=>{y.forEach((t=>{const o=t[w];o&&e(o.x,o.y,c,p.flipped,1,`${t.color}55`)})),s.movement[m]={x:f.x,y:f.y,flipped:E},m+=1,w+=1},D=(e,t,o)=>{let n=!1;return l.forEach((a=>{e.newX-e.halfWidth<a.x+a.width&&e.newX+e.halfWidth>a.x&&e.newY-e.halfHeight<a.y+a.height&&e.newY+e.halfHeight>a.y&&(n=!0,((e,t)=>e.y+e.halfHeight<t.y&&e.newY+e.halfHeight>=t.y)(e,a)||((e,t)=>e.y-e.halfHeight>=t.y+t.height&&e.newY-e.halfHeight<t.y+t.height)(e,a)?(e.newY-=o,H||(M=!0)):(((e,t)=>e.x-e.halfWidth>=t.x+t.width&&e.newX-e.halfWidth<t.x+t.width)(e,a)||((e,t)=>e.x+e.halfWidth<=t.x&&e.newX+e.halfWidth>=t.x)(e,a))&&(e.newX-=t))})),n},F=e=>{i.forEach((t=>{e.newX-e.halfWidth<t.x+t.width&&e.newX+e.halfWidth>t.x&&e.newY-e.halfHeight<t.y+t.height&&e.newY+e.halfHeight>t.y&&(u[t.id].collected(),i.splice(i.indexOf(t),1))}))};function _(e=!0){document.getElementById("morphball").style.display="inline",document.getElementById("moveInstructions").innerHTML="Use '<strong>A</strong>', '<strong>D</strong>', and '<strong>W</strong>' to move, ",$=!0,C=!0,!0===e&&(n(f.name,"morphball"),k.play())}function N(e=!0){document.getElementById("screwattack").style.display="inline",document.getElementById("spaceInstructions").innerHTML="<strong>SPACE</strong> to ultra flip",H=!0,!0===e&&(n(f.name,"screwattack"),k.play())}function G(){I||(d.push(new a(640*Math.random(),480*Math.random(),10*Math.random()+30,4*Math.random()+3,T)),v.play()),S<255&&(S+=.2),d.forEach((e=>{d.indexOf(e)!=d.length-1?e.color=`rgba(${S}, ${S}, ${S}, 0.1)`:(e.color=`${T}${S.toString(16).substring(0,2)}`,console.log(e.color))})),l.forEach((e=>{e.color=`rgba(${S}, ${S}, ${S}, 0.5)`})),I=!0}const J=e=>{switch(e.keyCode){case 65:case 68:W[e.keyCode]=!0;break;case 87:$&&(W[e.keyCode]=!0);break;case 32:e.preventDefault(),W[e.keyCode]||(M||H)&&(E=!E,M=!1),W[e.keyCode]=!0}},U=e=>{switch(e.keyCode){case 65:case 68:case 87:case 32:W[e.keyCode]=!1}},z=async t=>{const o=t.querySelector("#nameField").value,n=`name=${o}&age=&color=${t.querySelector("#colorField").value}`;(async(t,o)=>{const n=document.querySelector("#createResponse");let l=!0;switch(t.status){case 200:n.innerHTML=`<b>Logged in as existing user ${o}</b>`;break;case 201:n.innerHTML=`<b>Now playing as new player ${o}</b>`;break;case 400:n.innerHTML="<b>Bad Login Request</b>",l=!1;break;default:n.innerHTML="Error code not implemented by client.",l=!1}const i=await t.json();if(i.message&&(n.innerHTML+=`<p>${i.message}</p>`),l){const t=document.getElementById("submitBtn");t.value="Logged in",t.disabled=!0,i&&((t,o)=>{t&&t.player?(f.name=t.player.name,T=t.player.color,console.log(T),t.player.items&&function(e){e.morphball&&_(!1),e.screwattack&&N(!1)}(t.player.items)):f.name=o,s.name=f.name,s.color=T,s.movement=[],v=new Audio("buttonClick.wav"),v.volume=.25,k=new Audio("itemGet.wav"),k.volume=.25;let n=document.querySelector("#canvas_player"),l=document.querySelector("#canvas_walkers"),i=document.querySelector("#canvas_bg");h=l.getContext("2d"),c=n.getContext("2d"),r=i.getContext("2d"),x=l.width,b=l.height,document.addEventListener("keydown",J),document.addEventListener("keyup",U),e(300,300,c,!1);for(let e=0;e<10;e++)d.push(new a(640*Math.random(),480*Math.random(),10*Math.random()+30,4*Math.random()+3,"rgba(0,0,0,0.3)"));O(),h.fillStyle="black",f.x=f.y=300,setInterval(P,1e3/60),setInterval(O,1e3/15),setInterval(j,1e3),setInterval(R,1e3/30)})(i,o)}})(await fetch("/addPlayer",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:n}),o)};window.onload=()=>{const e=document.querySelector("#playerForm");e.addEventListener("submit",(t=>(t.preventDefault(),z(e),!1)))}})();