(()=>{"use strict";const e=(e,t,o,n,a)=>{n&&(a*=-1),o.clearRect(0,0,640,480),o.save(),o.beginPath(),o.arc(e,t-3*a,3,0,2*Math.PI),o.moveTo(e,t),o.lineTo(e,t+5*a),o.lineTo(e-2*a,t+8*a),o.moveTo(e,t+5*a),o.lineTo(e+2*a,t+8*a),o.moveTo(e-3*a,t+3*a),o.lineTo(e+3*a,t+3*a),o.stroke(),o.closePath(),o.restore()},t=(e,t,o,n,a,l,h)=>{a.save(),a.beginPath(),a.moveTo(e,t),a.lineTo(e+o,t),a.lineTo(e+o,t+n),a.lineTo(e,t+n),a.closePath(),h?(a.fillStyle=l,a.fill()):(a.strokeStyle=l,a.lineWidth=3,a.stroke()),a.restore()},o=async(e,t)=>{const o=`name=${e}&item=${t}`;(async(e,t)=>{switch(document.querySelector("#createResponse"),e.status){case 200:case 204:break;default:console.error("Error Updating Player: The item collected was not saved to server! Did you format the POST request correctly?")}})(await fetch("/updateItems",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:o}))};class n{constructor(e,t,o,n,a){this.x=e,this.y=t,this.width=o,this.height=n,this.color=a,this.hSpeed=n*o/15,this.vSpeed=0}}const a=[{x:280,y:315,width:31,height:30,color:"red"},{x:0,y:0,width:30,height:800,color:"blue"},{x:0,y:950,width:30,height:502,color:"blue"},{x:-200,y:801,width:30,height:30,color:"red"},{x:-200,y:700,width:200,height:50,color:"blue"},{x:-200,y:998,width:200,height:50,color:"blue"},{x:-650,y:700,width:200,height:50,color:"blue"},{x:-650,y:998,width:200,height:50,color:"blue"},{x:-650,y:750,width:50,height:250,color:"blue"},{x:1e3,y:36,width:30,height:1500,color:"green"},{x:0,y:1500,width:1030,height:30,color:"black"},{x:0,y:0,width:1030,height:30,color:"orange"}],l=[{x:-540,y:982,width:16,height:16,id:"screwattack"},{x:300,y:982,width:16,height:16,id:"morphball"}];let h,i,r;const c=[],d={screwattack:document.getElementById("screwattack"),morphball:document.getElementById("morphball")},s={screwattack:{obtained:!1,collected:function(){document.getElementById("screwattack").style.display="inline",document.getElementById("spaceInstructions").innerHTML="<strong>SPACE</strong> to ultra flip,",v=!0,o(y.name,"screwattack")}},morphball:{obtained:!1,collected:function(){document.getElementById("morphball").style.display="inline",document.getElementById("moveInstructions").innerHTML="Use '<strong>A</strong>', '<strong>D</strong>', and '<strong>W</strong>' to move, ",k=!0,T=!0,o(y.name,"morphball")}}},y={x:300,y:300,halfWidth:4,halfHeight:7,newX:300,newY:300,scale:1,name:""};let w,g,u,m,p,f,x=!1,b=!0,v=!1,k=!1,T=!1,S=0,E=[],H=0,I=0,M=0;const C=()=>{L(),e(y.x+I,y.y+M,i,x,y.scale),((e,t,o,n)=>{t.fillRect(e.x+o-e.width/2,e.y+n-e.height/2,e.width,e.height,"blue")})(y,i,I,M),W()},L=()=>{let e=0,t=0;E[65]&&(e=-2),E[68]&&(e=2),k?E[87]&&(M-=((e,t)=>{let o=4,n=0;return t&&(o=-4),1===e.scale?(e.scale=.1,e.halfWidth=1,e.halfHeight=1,n=-o):(e.scale=1,e.halfWidth=4,e.halfHeight=7,n=-3*o),e.y+=n,n})(y,x),k=!1,S=30):T&&(S-=1,S<=0&&(k=!0)),t=x?-3:3,y.newX=y.x+e,y.newY=y.y+t;let o=Y(y);0==o.length?(y.x+=e,y.y+=t,I-=e,M-=t):(o.forEach((o=>{($(y,o)||_(y,o))&&(y.newY-=t,v||(b=!0)),(A(y,o)||B(y,o))&&(y.newX-=e)})),I+=y.x-y.newX,M+=y.y-y.newY,y.x=y.newX,y.y=y.newY),q(y)},W=()=>{a.forEach((e=>{t(e.x+I,e.y+M,e.width,e.height,i,e.color,!0)})),l.forEach((e=>{i.drawImage(d[e.id],e.x+I,e.y+M)}))},P=()=>{r.clearRect(0,0,640,480),t(0,0,w,g,r,"white",!0),H+=0,c.forEach((function(e){e.hSpeed=1*Math.cos(H),e.vSpeed=1*Math.sin(H),e.x+=e.hSpeed,e.y+=e.vSpeed,e.x>w+20?e.x=-20:e.x<-20&&(e.x=w+20),e.y>g+20?e.y=-20:e.y<-20&&(e.y=g+20),t(e.x,e.y,e.width,e.height,r,e.color,!0)}))},X=()=>{},Y=e=>{const t=[];return a.forEach((o=>{e.newX-e.halfWidth<o.x+o.width&&e.newX+e.halfWidth>o.x&&e.newY-e.halfHeight<o.y+o.height&&e.newY+e.halfHeight>o.y&&t.push(o)})),t},q=e=>{l.forEach((t=>{e.newX-e.halfWidth<t.x+t.width&&e.newX+e.halfWidth>t.x&&e.newY-e.halfHeight<t.y+t.height&&e.newY+e.halfHeight>t.y&&(s[t.id].collected(),l.splice(l.indexOf(t),1))}))},B=(e,t)=>e.x+e.halfWidth<=t.x&&e.newX+e.halfWidth>=t.x,A=(e,t)=>e.x-e.halfWidth>=t.x+t.width&&e.newX-e.halfWidth<t.x+t.width,$=(e,t)=>e.y+e.halfHeight<t.y&&e.newY+e.halfHeight>=t.y,_=(e,t)=>e.y-e.halfHeight>=t.y+t.height&&e.newY-e.halfHeight<t.y+t.height,R=e=>{switch(e.keyCode){case 65:case 68:E[e.keyCode]=!0;break;case 87:k&&(E[e.keyCode]=!0);break;case 32:e.preventDefault(),E[e.keyCode]||(b||v)&&(x=!x,b=!1),E[e.keyCode]=!0}},D=e=>{switch(e.keyCode){case 65:case 68:case 87:case 32:E[e.keyCode]=!1}};window.onload=()=>{const t=document.querySelector("#playerForm");t.addEventListener("submit",(o=>(o.preventDefault(),(async t=>{const o=t.querySelector("#nameField").value,a=`name=${o}&age=&color=${t.querySelector("#colorField").value}`;(async(t,o)=>{const a=document.querySelector("#createResponse");let l=!0;switch(t.status){case 200:a.innerHTML=`<b>Logged in as existing user ${o}</b>`;break;case 201:a.innerHTML=`<b>Now playing as new player ${o}</b>`;break;case 400:a.innerHTML="<b>Bad Login Request</b>",l=!1;break;default:a.innerHTML="Error code not implemented by client.",l=!1}const d=await t.json();if(d.message&&(a.innerHTML+=`<p>${d.message}</p>`),l){const t=document.getElementById("submitBtn");t.value="Logged in",t.disabled=!0,d&&((t,o)=>{t&&t.player?t.player.name&&(y.name=t.player.name):y.name=o,console.log(y.name),u=new Audio("./sounds/blue_walker.wav"),u.volume=.25,m=new Audio("./sounds/red_walker.wav"),m.volume=.25,p=new Audio("./sounds/green_spawn.wav"),p.volume=.25,f=new Audio("./sounds/green_get.wav"),f.volume=.25;let a=document.querySelector("#canvas_player"),l=document.querySelector("#canvas_walkers"),d=document.querySelector("#canvas_bg");h=l.getContext("2d"),i=a.getContext("2d"),r=d.getContext("2d"),w=l.width,g=l.height,document.addEventListener("keydown",R),document.addEventListener("keyup",D),e(300,300,i,!1);for(let e=0;e<10;e++)c.push(new n(640*Math.random(),480*Math.random(),10*Math.random()+30,4*Math.random()+3,"rgba(0,0,0,0.3)"));P(),h.fillStyle="black",y.x=y.y=300,setInterval(C,1e3/60),setInterval(P,1e3/15),setInterval(X,1e3)})(d,o)}})(await fetch("/addPlayer",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:a}),o)})(t),!1)))}})();